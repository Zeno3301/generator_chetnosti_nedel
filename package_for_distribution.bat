@echo off
chcp 65001 >nul
echo ========================================
echo    –§–ò–ù–ê–õ–¨–ù–ê–Ø –£–ü–ê–ö–û–í–ö–ê (–†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø)
echo ========================================
echo.

REM
set "APP_NAME=–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–µ—Ç–Ω–æ—Å—Ç–∏ –Ω–µ–¥–µ–ª—å"
set "VERSION=1.0"
set "PACKAGE_DIR=–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–µ—Ç–Ω–æ—Å—Ç–∏ –Ω–µ–¥–µ–ª—å v%VERSION%"
set "ZIP_NAME=–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–µ—Ç–Ω–æ—Å—Ç–∏ –Ω–µ–¥–µ–ª—å_v%VERSION%.zip"

echo –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—á—É—é —Å–±–æ—Ä–∫—É...
if not exist "dist\%APP_NAME%\%APP_NAME%.exe" (
    echo [–û–®–ò–ë–ö–ê] –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–±–æ—Ä–∫—É: fix_and_build.bat
    pause
    exit /b 1
)

echo [‚úì] –†–∞–±–æ—á–∞—è —Å–±–æ—Ä–∫–∞ –Ω–∞–π–¥–µ–Ω–∞
echo.

REM

echo 1. –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏...
if exist "%PACKAGE_DIR%" (
    echo [i] –£–¥–∞–ª—è—é —Å—Ç–∞—Ä—É—é –ø–∞–ø–∫—É "%PACKAGE_DIR%"...
    rmdir /s /q "%PACKAGE_DIR%"
)
mkdir "%PACKAGE_DIR%"
if errorlevel 1 (
    echo [–û–®–ò–ë–ö–ê] –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É!
    pause
    exit /b 1
)
echo [‚úì] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞: %PACKAGE_DIR%
echo.

REM –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É - –ö–û–ü–ò–†–£–ï–ú –í–°–Æ –ü–ê–ü–ö–£!
echo 2. –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É –∏ –≤—Å–µ —Ñ–∞–π–ª—ã...
xcopy "dist\%APP_NAME%\*.*" "%PACKAGE_DIR%\" /E /I /Y /Q
if errorlevel 1 (
    echo [–û–®–ò–ë–ö–ê] –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É!
    pause
    exit /b 1
)

REM –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
for /f %%i in ('dir "%PACKAGE_DIR%" /B /A-D ^| find /c /v ""') do set "FILE_COUNT=%%i"
echo [‚úì] –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: %FILE_COUNT%
echo.

REM –ö–æ–ø–∏—Ä—É–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
echo 3. –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é...
set "DOCS_COPIED=0"

if exist "README.md" (
    copy "README.md" "%PACKAGE_DIR%\README.md" >nul
    set /a DOCS_COPIED+=1
    echo   [‚úì] README.md
)

if exist "README.txt" (
    copy "README.txt" "%PACKAGE_DIR%\README.txt" >nul
    set /a DOCS_COPIED+=1
    echo   [‚úì] README.txt
)

if exist "test_scenarios.md" (
    copy "test_scenarios.md" "%PACKAGE_DIR%\–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï.txt" >nul
    set /a DOCS_COPIED+=1
    echo   [‚úì] –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï.txt
)

if exist "LICENSE" (
    copy "LICENSE" "%PACKAGE_DIR%\LICENSE" >nul
    set /a DOCS_COPIED+=1
    echo   [‚úì] LICENSE
)

if %DOCS_COPIED% EQU 0 (
    echo   [i] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
)
echo.

REM –°–æ–∑–¥–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
echo 4. –°–æ–∑–¥–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...
(
    echo ========================================
    echo    –ì–ï–ù–ï–†–ê–¢–û–† –ß–ï–¢–ù–û–°–¢–ò –ù–ï–î–ï–õ–¨
    echo ========================================
    echo.
    echo –í–µ—Ä—Å–∏—è: %VERSION%
    echo –î–∞—Ç–∞ —Å–±–æ—Ä–∫–∏: %date% %time%
    echo.
    echo ========================================
    echo    –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨
    echo ========================================
    echo.
    echo 1. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤ "%ZIP_NAME%"
    echo 2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É: %PACKAGE_DIR%
    echo 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª: "%APP_NAME%.exe"
    echo.
    echo –ï—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
    echo   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å run_debug.bat
    echo   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å
    echo   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å Windows 7 –∏–ª–∏ –Ω–æ–≤–µ–µ
    echo.
) > "%PACKAGE_DIR%\!!–ü–†–û–ß–¢–ò_–ú–ï–ù–Ø!!.txt"

REM –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
dir "%PACKAGE_DIR%" /B /A-D >> "%PACKAGE_DIR%\!!–ü–†–û–ß–¢–ò_–ú–ï–ù–Ø!!.txt"
(
    echo.
    echo ========================================
    echo    –§–£–ù–ö–¶–ò–û–ù–ê–õ –ü–†–û–ì–†–ê–ú–ú–´
    echo ========================================
    echo.
    echo 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ–¥–µ–ª—å —É—á–µ–±–Ω–æ–≥–æ –≥–æ–¥–∞ —Å —á–µ—Ç–Ω–æ—Å—Ç—å—é
    echo 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ç–Ω–æ—Å—Ç–∏ –Ω–µ–¥–µ–ª—å
    echo 3. –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –¥–ª—è Excel
    echo.
    echo ========================================
    echo    –°–ò–°–¢–ï–ú–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø
    echo ========================================
    echo.
    echo - Windows 7/8/10/11 (64-bit)
    echo - 100 –ú–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
    echo - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!
    echo.
    echo ========================================
    echo    –ö–û–ù–¢–ê–ö–¢–´
    echo ========================================
    echo.
    echo GitHub: https://github.com/Zeno3301/Academic-calendar
    echo.
    echo –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
    echo 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ run_debug.bat
    echo 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
    echo 3. –°–æ–∑–¥–∞–π—Ç–µ Issue –Ω–∞ GitHub
    echo.
    echo %date% %time%
) >> "%PACKAGE_DIR%\!!–ü–†–û–ß–¢–ò_–ú–ï–ù–Ø!!.txt"

echo [‚úì] –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: !!–ü–†–û–ß–¢–ò_–ú–ï–ù–Ø!!.txt
echo.

REM –°–æ–∑–¥–∞–µ–º ZIP –∞—Ä—Ö–∏–≤
echo 5. –°–æ–∑–¥–∞–µ–º ZIP-–∞—Ä—Ö–∏–≤...
if exist "%ZIP_NAME%" (
    echo [i] –£–¥–∞–ª—è—é —Å—Ç–∞—Ä—ã–π –∞—Ä—Ö–∏–≤ "%ZIP_NAME%"...
    del "%ZIP_NAME%"
)

echo [ ] –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º... (—ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è)
powershell -Command "$ErrorActionPreference = 'Stop'; try { Compress-Archive -Path '%PACKAGE_DIR%\*' -DestinationPath '%ZIP_NAME%' -CompressionLevel Optimal -Force; Write-Host '[‚úì]' } catch { Write-Host '[–û–®–ò–ë–ö–ê]' ; Write-Host $_.Exception.Message; exit 1 }"

if errorlevel 1 (
    echo [–û–®–ò–ë–ö–ê] –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤!
    echo.
    echo –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
    echo 1. –§–∞–π–ª —É–∂–µ –æ—Ç–∫—Ä—ã—Ç –≤ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
    echo 2. –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å
    echo 3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
    echo.
    pause
    exit /b 1
)

echo [‚úì] –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: %ZIP_NAME%
echo.

REM –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–º–µ—Ä–µ
echo 6. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–∫–µ—Ç–µ:
echo.

REM –†–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏
for /f "tokens=3" %%A in ('dir "%PACKAGE_DIR%" /-C ^| find "File(s)"') do set "FOLDER_SIZE=%%A"
echo    –ü–∞–ø–∫–∞: %PACKAGE_DIR% (%FOLDER_SIZE% –±–∞–π—Ç)

REM –†–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞
for %%I in ("%ZIP_NAME%") do (
    set "BYTES=%%~zI"
    set /a "MB=BYTES / 1048576"
    set /a "KB=(BYTES %% 1048576) / 1024"
    echo    –ê—Ä—Ö–∏–≤: %ZIP_NAME% (%BYTES% –±–∞–π—Ç = %MB% –ú–ë %KB% –ö–ë)
)

echo.
echo    –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞—Ä—Ö–∏–≤–∞:
echo    -----------------
dir "%PACKAGE_DIR%" /B | findstr /V "::$"
echo.

echo.
echo ========================================
echo    –£–ü–ê–ö–û–í–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û! üéâ
echo ========================================
echo.
echo –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –∞—Ä—Ö–∏–≤:
echo   %ZIP_NAME%
echo.
echo –†–∞–∑–º–µ—Ä: %MB% –ú–ë
echo.
if %MB% GTR 20 (
    echo    –í–ù–ò–ú–ê–ù–ò–ï: –ê—Ä—Ö–∏–≤ –±–æ–ª—å—à–æ–π!
    echo    –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª–æ–æ–±–º–µ–Ω–Ω–∏–∫
    echo.
)
pause